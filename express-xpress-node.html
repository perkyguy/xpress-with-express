<html>

<head>
    <title>Xpress and Express</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="http://bernii.github.io/gauge.js/dist/gauge.min.js"></script>
</head>

<body>
    <script type="text/javascript">
        var relays = [false, false];
        var adccs = [{
            auto: false,
            interval: undefined,
            gauge: undefined
        }, {
            auto: false,
            interval: undefined,
            gauge: undefined
        }]
        console.log('We assume the relay is shut at load time, so if you enable it and come back, then we don\'t get the current status. Just an FYI...');
        $(document).ready(function() {
            var default_gauge_options = {
                lines: 12, // The number of lines to draw
                angle: 0.15, // The length of each line
                lineWidth: 0.44, // The line thickness
                pointer: {
                    length: 0.72, // The radius of the inner circle
                    strokeWidth: 0.038, // The rotation offset
                    color: '#000000' // Fill color
                },
                limitMax: 'true', // If true, the pointer will not go past the end of the gauge
                colorStart: '#6FADCF', // Colors
                colorStop: '#8FC0DA', // just experiment with them
                strokeColor: '#E0E0E0', // to see which ones work best for you
                generateGradient: true,
                percentColors: [
                    [0.0, "#a9d70b"],
                    [0.50, "#f9c802"],
                    [1.0, "#ff0000"]
                ]
            };
            adccs.forEach(function(adcc, adcc_num) {
                var target = document.getElementById('adcc-progress-' + (adcc_num + 1));
                adcc.gauge = new Gauge(target).setOptions(default_gauge_options); // create sexy gauge!
                adcc.gauge.maxValue = 1024; // set max gauge value
                adcc.gauge.animationSpeed = 1; // set animation speed (32 is default value)
                console.log(adcc.gauge.set(0));
            });
            $(".relay-action").click(function() {
                var action = $(this).attr('data-relay-action');
                var relay_number = +($(this).attr('data-relay-number') || 1);
                var relay_state = relays[relay_number];
                if (action == "toggle") {
                    relay_state = !relay_state;
                } else {
                    relay_state = (action == "enable");
                }
                $(this).addClass(relay_state ? 'btn-success' : 'btn-danger');
                $(this).removeClass(!relay_state ? 'btn-success' : 'btn-danger');
                relays[relay_number] = relay_state;
                $.get('/relay/' + (relay_state ? 'enable' : 'disable') + '/' + relay_number, function(res) {
                    toastr.success(res.msg, 'Survey says?!');
                })
            });

            function stopAdccReadings(button, adcc_obj) {
                toastr.error("Stopping ADCC " + $(button).attr('data-adcc-num'), 'ADCC Grabbing');
                $(button).removeClass('btn-success');
                clearInterval(adcc_obj.interval);
            }

            $('.adcc-action').click(function() {
                var button = $(this);
                var adcc_num = +(button.attr('data-adcc-num') || 1);
                var adcc_obj = adccs[adcc_num - 1];
                adcc_obj.auto = !(adcc_obj.auto);
                var interval = 250;

                if (adcc_obj.auto) {
                    toastr.info("Starting to grab ADCC" + adcc_num + " values every " + interval + "ms", 'ADCC Grabbing');
                    button.addClass('btn-success');
                    adccs[adcc_num % 2].auto = false;
                    adcc_obj.interval = setInterval(function() {
                        if (adcc_obj.auto) {
                            $.get('/adcc/' + adcc_num, function(res) {
                                if (!isNaN(+(res.value))) {
                                    adcc_obj.gauge.set(res.value + 0.01);
                                }
                            })
                        } else {
                            stopAdccReadings(button, adcc_obj);
                        }
                    }, interval);
                } else {
                    stopAdccReadings(button, adcc_obj);
                }
            });
        });
    </script>

    <nav class="navbar navbar-inverse navbar-static-top">
        <div class="container">
            <a class="navbar-brand" href="/">Xpress with Express (and NodeJS)</a>
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Home</a>
                </li>
                <li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">ADCC Values<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="/adcc/1">POT 1</a></li>
                            <li><a href="/adcc/2">POT 2</a></li>
                        </ul>
                    </li>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Relay 1<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#" class="relay-action" data-relay-action="enable" data-relay-number="1">Enable</a></li>
                        <li><a href="#" class="relay-action" data-relay-action="disable" data-relay-number="1">Disable</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Relay 2<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#" class="relay-action" data-relay-action="enable" data-relay-number="2">Enable</a></li>
                        <li><a href="#" class="relay-action" data-relay-action="disable" data-relay-number="2">Disable</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>
    <div class="row">
        <div class="jumbotron col-xs-8 col-xs-offset-2" style="padding:40px;">
            <h1>What do these buttons do?!</h1>
            <p>Currently we have the "relay" button and an ADCC button, so go ahead and click around!</p>
        </div>
    </div>
    <div class="row">
        <div class="col-md-5 col-xs-12 col-md-offset-1">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 col-xs-12">
                    <a class="btn btn-primary btn-block btn-lg relay-action" data-relay-action="toggle" data-relay-number="1" href="#" role="button">Toggle Relay 1!</a>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 col-md-offset-3 col-xs-12">
                    <a class="btn btn-primary btn-block btn-lg relay-action" data-relay-action="toggle" data-relay-number="2" href="#" role="button">Toggle Relay 2!</a>
                </div>
            </div>
        </div>
        <div class="col-md-5 col-xs-12 col-md-offset-1">
            <div class="row">
                <div class="col-md-6 col-xs-12">
                    <a class="btn btn-primary btn-block btn-lg adcc-action" data-adcc-action="get" data-adcc-num="1" href="#" role="button">Get ADCC Value 1!</a>
                </div>
            </div>
            <div class="row">
                <canvas class="col-md-offset-0 col-xs-6 col-xs-offset-3" id="adcc-progress-1"></canvas>
            </div>
            <div class="row">
                <div class="col-md-6 col-xs-12">
                    <a class="btn btn-primary btn-block btn-lg adcc-action" data-adcc-action="get" data-adcc-num="2" href="#" role="button">Get ADCC Value 2!</a>
                </div>
            </div>
            <div class="row">
                <canvas class="col-md-offset-0 col-xs-6 col-xs-offset-3" id="adcc-progress-2"></canvas>
            </div>
        </div>
    </div>
</body>

</html>