<html>

<head>
    <title>Xpress and Express</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
</head>

<body>
    <script type="text/javascript">
        var relay_state = false;
        var auto_adcc = false;
        var auto_adcc_interval;
        console.log('We know the relay as shut right now, so if you enable it and come back, then we don\'t get the current status. Just an FYI...');
        $(document).ready(function() {
            $(".relay-action").click(function() {
                var action = $(this).attr('data-relay-action');
                if (action == "toggle") {
                    relay_state = !relay_state;
                } else {
                    relay_state = (action == "enable");
                }
                $.get('/relay/' + (relay_state ? 'enable' : 'disable'), function(res) {
                    toastr.success(res.msg, 'Survey says?!');
                })
            })
            $('.adcc-action').click(function() {
                auto_adcc = !auto_adcc;
                var interval = 250;
                if (auto_adcc) {
                    toastr.success("Starting to grab ADCC values every " + interval + "ms", 'ADCC Grabbing');
                    auto_adcc_interval = setInterval(function() {
                        $.get('/adcc', function(res) {
                            if (res.value) {
                                var value_percentage = (res.value / 1024) * 100;
                                $("#adcc-progress").attr('value', res.value);
                            }
                        })
                    }, interval);
                } else {
                    toastr.error("Stopping...", 'ADCC Grabbing');
                    clearInterval(auto_adcc_interval);
                }
            });
        });
    </script>

    <div style="margin:100px;">
        <nav class="navbar navbar-inverse navbar-static-top">
            <div class="container">
                <a class="navbar-brand" href="/">Xpress with Express (and NodeJS)</a>
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a href="/">Home</a>
                    </li>
                    <li>
                        <a href="/adcc">ADCC</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Relay<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#" class="relay-action" data-relay-action="enable">Enable</a></li>
                            <li><a href="#" class="relay-action" data-relay-action="disable">Disable</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="jumbotron" style="padding:40px;">
            <h1>What's the button do?!</h1>
            <p>Currently we have the "relay" button and an ADCC button, so go ahead and click around!</p>
            <p>
                <div class="row">
                    <div class="col-md-4 col-xs-12 col-md-offset-2">
                        <a class="btn btn-primary btn-lg relay-action" data-relay-action="toggle" href="#" role="button">Toggle Relay!</a>
                    </div>
                    <div class="col-md-4 col-xs-12 col-md-offset-2">
                        <a class="btn btn-primary btn-lg adcc-action" data-adcc-action="get" href="#" role="button">Get ADCC Value!</a>
                        <progress id="adcc-progress" role="progressbar" value="0" max="1024"></progress>
                    </div>
                </div>
            </p>
        </div>
    </div>
</body>

</html>